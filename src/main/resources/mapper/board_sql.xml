<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board_sql">
	<insert id="insert" parameterType="board" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO Board
		(
			title,
			content,
			writer,
			boardType
		)
		values
		(
			'${title}',
			'${content}',
			${writer},
			${boardType}
		)
	</insert>
	
	<select id="select" parameterType="board" resultType="board">
		SELECT 
			board.*,
			(SELECT COUNT(*) FROM FileInfo WHERE boardId = board.id) AS fileCnt,
			(SELECT COUNT(*) FROM PhotoInfo WHERE boardId = board.id) AS pictureCnt,
			usr.username AS writerName
		FROM 
			Board board LEFT JOIN users usr ON (board.writer = usr.id)
		<where>
			board.boardType = ${boardType}
		</where>
		order by board.id desc
		LIMIT ${from}, ${pageSize}
	</select>
	
	<select id="count" parameterType="board" resultType="int">
		SELECT COUNT(*) FROM Board
		<where>
			boardType = ${boardType}
		</where>
	</select>
</mapper>