<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user_sql">
	<insert id="insert" parameterType="user">
		INSERT INTO users
		(
			user_role,
			login,
			password,
			username,
			phone,
			email,
			classification,
			level,
			address,
			telephone,
			domain,
			addressDetail
		)
		VALUES
		(
			${user_role},
			'${login}',
			'${password}',
			'${username}',
			'${phone}',
			'${email}',
			'${classification}',
			'${level}',
			'${address}',
			'${telephone}',
			'${domain}',
			'${addressDetail}'
		)
		
	</insert> 
	<select id="select" parameterType="user" resultType="user">
		SELECT * FROM users
		<where>
		login = '${login}'
		</where>
	</select>
	<select id="search" parameterType="user" resultType="user">
		SELECT 
			u.*, r.role_name, r.role_name_kr 
		FROM 
			users u LEFT JOIN roles r on (u.user_role = r.id)
		<where>
			<if test="query != ''">
				and
				(
					u.username like '%${query}%'
				)
			</if>
		</where>
		ORDER BY u.id DESC
		LIMIT ${from}, ${pageSize}
	</select>
	<select id="select_one" parameterType="user" resultType="user">
		SELECT u.*, r.role_name, r.role_name_kr FROM 
		users u 
			LEFT JOIN roles r on (u.user_role = r.id)
		<where>
			<choose>
				<when test="id > 0">
					u.id = ${id}
				</when>
				<otherwise>
					u.login = '${login}'
				</otherwise>
			</choose>
		</where>
	</select>
	
	<select id="select_no_pwd_user" parameterType="user" resultType="user">
		SELECT u.*, r.role_name FROM 
		users u 
			LEFT JOIN roles r on (u.user_role = r.id)
		<where>
		login = '${login}'
		</where>
	</select>
	
	<update id="update" parameterType="user">
		UPDATE users
		<set>
			<if test="user_role > 0">
				user_role = ${user_role},
			</if>
			<if test="password != null and !password.equals('')">
				password = '${password}',
			</if>
			<if test="phone != null and !phone.equals('')">
				phone = '${phone}',
			</if>
			<if test="email != null and !email.equals('')">
				email = '${email}',
			</if>
			<if test="classification != null and !classification.equals('')">
				classification = '${classification}',
			</if>
			<if test="level != null and !level.equals('')">
				level = '${level}',
			</if>
			<if test="address != null and !address.equals('')">
				address = '${address}',
			</if>
			<if test="domain != null and !domain.equals('')">
				domain = '${domain}',
			</if>
			<if test="addressDetail != null and !addressDetail.equals('')">
				addressDetail = '${addressDetail}',
			</if>
		</set>
		<where>
			id = ${id}
		</where>
	</update>
	
	<select id="count" parameterType="user" resultType="int">
		SELECT COUNT(*) FROM users
		<where>
			<if test="query != ''">
				and
				(
					username like '%${query}%'
				)
			</if>
		</where>
	</select>
	
	<delete id="delete" parameterType="user">
		DELETE FROM users
		<where>
			id = ${id}
		</where>
	</delete>
	
	<select id="roles" resultType="user_role">
		SELECT * FROM roles
	</select>
</mapper>